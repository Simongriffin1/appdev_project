<h1 class="page-title">Welcome back, <%= current_user.email %></h1>
<p class="muted">Your personal AI journaling space. Start by answering today's question or browsing recent entries.</p>

<div class="card-grid">
  <!-- Current prompt -->
  <section class="card">
    <h2 class="card__title">Today's question</h2>
    <p class="card__subtitle">
      Generated from your recent reflections.
    </p>

    <% if @latest_prompt %>
      <p><%= @latest_prompt.body %></p>

      <div class="btn-row">
        <%= link_to "Answer this question", prompt_path(@latest_prompt), class: "btn btn-primary" %>

        <%= form_with url: generate_prompts_path, method: :post, class: "inline-form" do |f| %>
          <%= f.submit "Generate a new AI question", class: "btn btn-ghost" %>
        <% end %>
      </div>
    <% else %>
      <p class="muted">
        You don't have a question yet. Let the AI read your (future) entries and suggest focused follow-ups.
      </p>

      <div class="btn-row">
        <%= form_with url: generate_prompts_path, method: :post do |f| %>
          <%= f.submit "Get my first AI question", class: "btn btn-primary" %>
        <% end %>
      </div>
    <% end %>
  </section>

  <!-- Quick links -->
  <section class="card">
    <h2 class="card__title">Quick actions</h2>
    <ul class="entry-list">
      <li class="entry-list__item">
        <%= link_to "Write a free-form entry", new_journal_entry_path, class: "btn btn-ghost" %>
      </li>
      <li class="entry-list__item">
        <%= link_to "Browse all entries", journal_entries_path, class: "btn btn-ghost" %>
      </li>
      <li class="entry-list__item">
        <%= link_to "Browse by topic", topics_path, class: "btn btn-ghost" %>
      </li>
    </ul>
  </section>

  <!-- Recent entries -->
  <section class="card card--full">
    <h2 class="card__title">Recent entries</h2>

    <% if @recent_entries.any? %>
      <ul class="entry-list">
        <% @recent_entries.each do |entry| %>
          <li class="entry-list__item">
            <div class="entry-meta">
              <%= entry.created_at.strftime("%b %-d, %Y") %>
              <% if entry.prompt %>
                Â· From question: "<%= entry.prompt.body.truncate(60) %>"
              <% end %>
            </div>

            <div class="entry-body">
              <%= entry.body.truncate(160) %>
            </div>

            <div class="btn-row" style="margin-top: 0.4rem;">
              <%= link_to "Open entry", journal_entry_path(entry), class: "btn btn-ghost" %>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="muted">No entries yet. Answer your first question above to get started.</p>
    <% end %>
  </section>
</div>

<div class="card">
  <h1 class="page-title">Settings</h1>
  <p class="muted">Configure when and how often you receive journaling prompts via email.</p>

  <% if @user.errors.any? %>
    <div class="flash flash--alert">
      <% @user.errors.full_messages.each do |msg| %>
        <div><%= msg %></div>
      <% end %>
    </div>
  <% end %>

  <%= form_with model: @user, url: settings_path, method: :patch do |f| %>
    <div class="form-field">
      <%= f.label :time_zone, "Time Zone" %>
      <%= f.time_zone_select :time_zone, ActiveSupport::TimeZone.all, { default: "America/Chicago", selected: @user.time_zone || "America/Chicago" }, { required: true } %>
      <small class="muted">All times will be in your local time zone.</small>
    </div>

    <div class="form-field">
      <%= f.label :prompt_frequency, "Email Frequency" %>
      <%= f.select :prompt_frequency, 
          options_for_select([
            ["Daily", "daily"],
            ["Weekdays only", "weekdays"],
            ["Weekly", "weekly"]
          ], @user.prompt_frequency),
          { prompt: "Select frequency" },
          { required: true } %>
    </div>

    <div class="form-field">
      <%= f.label :send_times, "Send Times (local time)" %>
      <%= f.text_field :send_times, 
          value: @user.send_times || "09:00,21:00",
          placeholder: "09:00,21:00",
          required: true %>
      <small class="muted">Comma-separated times in 24-hour format (e.g., "09:00,21:00" for 9am and 9pm).</small>
    </div>

    <div class="btn-row">
      <%= f.submit "Save Settings", class: "btn btn-primary" %>
      <% if current_user.onboarding_complete? %>
        <%= link_to "Cancel", dashboard_path, class: "btn btn-ghost" %>
      <% end %>
    </div>
  <% end %>
</div>

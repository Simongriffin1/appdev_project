# Production Deployment Checklist

## Quick Reference

### Pre-Deployment

```bash
# 1. Set environment variables (see PRODUCTION_READINESS.md)
# 2. Run migrations
bin/rails db:migrate

# 3. Test locally
bin/rails db:create db:migrate
bin/server  # Terminal 1
bin/jobs    # Terminal 2

# 4. Run smoke tests (optional)
bundle exec rspec spec/models/user_spec.rb
bundle exec rspec spec/services/prompt_sender_spec.rb
```

### Production Deployment

```bash
# 1. Set environment variables in hosting platform
# 2. Deploy (git push)
# 3. Run migrations (if not auto-run)
bin/rails db:migrate

# 4. Start worker (if separate process)
bin/jobs

# 5. Verify
curl https://yourdomain.com/up
```

## Required Environment Variables

```bash
# Core
SECRET_KEY_BASE=<auto-generated>
DATABASE_URL=<provided>
RAILS_ENV=production

# Email (Postmark)
POSTMARK_API_TOKEN=<your_token>
INBOUND_EMAIL_DOMAIN=<your_domain>
MAIL_FROM=<your_email>
MAIL_HOST=<your_domain>

# Optional
OPENAI_API_KEY=<optional>
ROLLBAR_ACCESS_TOKEN=<optional>
RAILS_LOG_LEVEL=info
RAILS_MAX_THREADS=5
WEB_CONCURRENCY=2
```

## ActionMailbox Setup

1. **Postmark Inbound:**
   - Add domain in Postmark dashboard
   - Configure MX record: `inbound.postmarkapp.com`
   - Set webhook: `https://yourdomain.com/rails/action_mailbox/postmark/inbound_emails`

2. **Verify:**
   - Send test email to `reply+TOKEN@yourdomain.com`
   - Check Rails logs for processing

## Verification Steps

- [ ] Health check: `curl https://yourdomain.com/up`
- [ ] Email sending works (send test prompt)
- [ ] Inbound email works (reply to test prompt)
- [ ] Jobs running (check logs for `SendScheduledPromptsJob`)
- [ ] No secrets in logs
- [ ] SSL/HTTPS working

## Full Documentation

See `PRODUCTION_READINESS.md` for complete setup instructions.
